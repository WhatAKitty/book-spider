{"version":3,"sources":["../src/zhuishu.client.js"],"names":["rest","contentType","dataType","processZhuishuResp","data","filter","ok","err","msg","wrapBookInfo","cover","v2_urls","statics","wrapRankInfo","Zhuishu","recommends","params","gender","major","minor","start","limit","catBooks","type","cats","GET","subCats","optionMinor","books","map","book","ranks","Object","keys","reduce","res","key","val","Array","item","rankBooks","rankId","ranking","icon","authorBooks","author","searchBooks","search","bookInfo","bookId","info","booksErr","authorBook","_id","newestChapter","bookIds","all","chapters","mixToc","chaptersBySource","sourceId","content","link","chapter","comments"],"mappings":"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","file":"zhuishu.client.js","sourcesContent":["\n/**\n * 追书神器客户端描述文件\n * \n * 追书API参考：https://github.com/zimplexing/vue-nReader/blob/master/doc/zhuishushenqi.md\n * 感谢@zimplexing的文档\n * @date 2018-03-18\n */\n\nimport Rest from 'react-rest-kit';\nimport { config } from './config';\n\nconst rest = new Rest({\n  contentType: 'application/json',\n  dataType: 'json',\n});\n\nconst processZhuishuResp = (data, filter = (data) => ({ data })) => {\n  if ('undefined' !== typeof data.ok && !data.ok) {\n    // 追书神器返回错误\n    return { err: data.msg };\n  }\n\n  return filter(data);\n};\n\nconst wrapBookInfo = data => {\n  return {\n    ...data,\n    cover: config.v2_urls.statics() + data.cover,\n  };\n};\n\nconst wrapRankInfo = data => {\n  return {\n    ...data,\n    cover: config.v2_urls.statics() + data.cover,\n  };\n};\n\nconst Zhuishu = {\n  async recommends(params = {}) {\n    const { gender, major, minor, start = 0, limit = 20 } = params;\n\n    return this.catBooks({\n      gender,\n      type: 'hot',\n      major,\n      minor,\n      start,\n      limit,\n    });\n  },\n  async cats() {\n    const { data, err } = await rest.GET(config.v2_urls.cats());\n\n    if (err) {\n      return { err };\n    }\n\n    return processZhuishuResp(data);\n  },\n  async subCats() {\n    const { data, err } = await rest.GET(config.v2_urls.subCats());\n\n    if (err) {\n      return { err };\n    }\n\n    return processZhuishuResp(data);\n  },\n  async catBooks(params = {}) {\n    const { gender, type, major, minor, start = 0, limit = 20 } = params;\n    const optionMinor = minor ? { minor } : {};\n    const { data, err } = await rest.GET(config.v2_urls.catBooks(), {\n      gender,\n      type,\n      major,\n      start,\n      limit,\n      minor: minor ? minor : '',\n    });\n\n    if (err) {\n      return { err };\n    }\n\n    return processZhuishuResp(data, data => ({ data: data.books.map(book => wrapBookInfo(book)) }));\n  },\n  async ranks() {\n    const { data, err } = await rest.GET(config.v2_urls.ranks());\n\n    if (err) {\n      return { err };\n    }\n\n    return processZhuishuResp(data, data => ({\n      data: Object\n        .keys(data)\n        .reduce((res, key) => {\n          const val = data[key];\n          if (val instanceof Array) {\n            res[key] = val.map(item => wrapRankInfo(item));\n          } else {\n            res[key] = val;\n          }\n          return res;\n        }, {})\n    }));\n  },\n  async rankBooks(params = {}) {\n    const { rankId } = params;\n    const { data, err } = await rest.GET(config.v2_urls.rankBooks(rankId));\n\n    if (err) {\n      return { err };\n    }\n\n    return processZhuishuResp(data, data => ({\n      data: {\n        ...data,\n        ranking: {\n          ...data.ranking,\n          cover: config.v2_urls.statics() + data.ranking.cover,\n          icon: config.v2_urls.statics() + data.ranking.icon,\n          books: data.ranking.books.map(book => wrapBookInfo(book)),\n        },\n      }\n    }));\n  },\n  async authorBooks(params = {}) {\n    const { author = '' } = params;\n    const { data, err } = await rest.GET(config.v2_urls.authorBooks(author));\n\n    if (err) {\n      // 返回错误\n      return { err };\n    }\n\n    return processZhuishuResp(data, data => ({ data: data.books.map(book => wrapBookInfo(book)) }));\n  },\n  async searchBooks(params = {}) {\n    const { key = '' } = params;\n    const { data, err } = await rest.GET(config.v2_urls.search(key));\n\n    if (err) {\n      // 返回错误\n      return { err };\n    }\n\n    return processZhuishuResp(data, data => ({ data: data.books.map(book => wrapBookInfo(book)) }));\n  },\n  async bookInfo(params = {}) {\n    const { bookId } = params;\n    const { data, err } = await rest.GET(config.v2_urls.info(bookId));\n\n    if (err) {\n      // 返回错误\n      return { err };\n    }\n\n    const { data: authorBooks, err: booksErr } = await this.authorBooks({ author: data.author });\n\n    if (booksErr) {\n      return { err: booksErr };\n    }\n\n    return processZhuishuResp(data, data => ({\n      data: {\n        ...wrapBookInfo(data),\n        authorBooks: authorBooks.filter(authorBook => authorBook._id !== data._id),\n      }\n    }));\n  },\n  async newestChapter(params = {}) {\n    const { bookIds } = params;\n    const { data, err } = await rest.GET(config.v2_urls.newestChapter(bookIds));\n\n    if (err) {\n      // 返回错误\n      return { err };\n    }\n\n    return processZhuishuResp(data, data => ({\n      data: data.reduce((all, book) => {\n        all[book._id] = book;\n        return all;\n      }, {})\n    }));\n  },\n  async chapters(params = {}) {\n    const { bookId } = params;\n    const { data, err } = await rest.GET(config.v2_urls.chapters(bookId));\n\n    if (err) {\n      // 返回错误\n      return { err };\n    }\n\n    return processZhuishuResp(data, data => ({ data: data.mixToc.chapters }));\n  },\n  async chaptersBySource(params = {}) {\n    const { sourceId } = params;\n    const { data, err } = await rest.GET(config.v2_urls.chaptersBySource(sourceId));\n\n    if (err) {\n      // 返回错误\n      return { err };\n    }\n\n    return processZhuishuResp(data, data => ({ data: data.chapters }));\n  },\n  async content(params = {}) {\n    const { link } = params;\n    const { data, err } = await rest.GET(config.v2_urls.content(link));\n\n    if (err) {\n      // 返回错误\n      return { err };\n    }\n\n    return processZhuishuResp(data, data => ({ data: data.chapter }));\n  },\n  async comments(params = {}) {\n    return { err: '暂时不支持' };\n  },\n};\n\nexport default Zhuishu;\n"]}