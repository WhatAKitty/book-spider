{"version":3,"sources":["../../../src/core/parser/common.parser.js"],"names":["CommonParser","config","searchBookByName","bind","bookName","searchHtml","$","load","resultList","eles","search","toArray","length","resultEle","$title","find","title","name","text","trim","link","attr","chaptersHtml","chapter","chapters","map","$chapter","item","href","id","replace","contentHtml","$content","content","replaceWith","chapterContent"],"mappings":";AACA,qC;AACA,kC;;AAEMA,Y;;AAEJ;;AAEG,OADDC,MACC,QADDA,MACC;AACK;AACJA,oBADI,EADL;;;AAKD,UAAKC,gBAAL,GAAwB,MAAKA,gBAAL,CAAsBC,IAAtB,OAAxB,CALC;AAMF;;AAED;;;AAGiBC,c;AACU,uBAAKF,gBAAL,CAAsBE,QAAtB,C,SAAnBC,U;;AAEFA,8BAAc,I;AACT,oB;;;AAGLC,iB,GAAI,kBAAQC,IAAR,CAAaF,UAAb,C;AACFG,0B,GAAaF,EAAE,oIAAkBG,IAAlB,CAAuBC,MAAzB,EAAiCC,OAAjC,E;;AAEfH,2BAAWI,MAAX,KAAsB,C;;AAEjB,oB;;;AAGHC,yB,GAAYL,WAAW,CAAX,C;AACdM,sB,GAASR,EAAEO,SAAF,EAAaE,IAAb,CAAkB,oIAAkBN,IAAlB,CAAuBO,KAAzC,C;AACPC,oB,GAAOH,OAAOI,IAAP,GAAcC,IAAd,E;AACPC,oB,GAAON,OAAOO,IAAP,CAAY,MAAZ,C;AACTJ,wBAAQb,SAASe,IAAT,E;;AAEH,oB;;;AAGF;AACLF,4BADK;AAELG,4BAFK,E;;;;AAMT;;;AAGqBA,U;AACwBA,oB,SAArCE,Y;;AAEFA,gCAAgB,I;AACX,oB;;;AAGLhB,iB,GAAI,kBAAQC,IAAR,CAAae,YAAb,C;AACFd,0B,GAAaF,EAAE,oIAAkBG,IAAlB,CAAuBc,OAAzB,EAAkCZ,OAAlC,E;AACfH,2BAAWI,MAAX,KAAsB,C;;AAEjB,oB;;;AAGHY,wB,GAAWhB,WAAWiB,GAAX,CAAe,gBAAQ;AACtC,sBAAMC,WAAWpB,EAAEqB,IAAF,CAAjB;AACA,sBAAMC,OAAOF,SAASL,IAAT,CAAc,MAAd,CAAb;AACA,yBAAO;AACLQ,wBAAID,KAAKE,OAAL,CAAaV,IAAb,EAAmB,EAAnB,EAAuBU,OAAvB,CAA+B,KAA/B,EAAsC,EAAtC,EAA0CA,OAA1C,CAAkD,SAAlD,EAA6D,EAA7D,CADC;AAELd,2BAAOU,SAASR,IAAT,EAFF;AAGLE,0BAAMM,SAASL,IAAT,CAAc,MAAd,CAHD,EAAP;;AAKD,iBARgB,C;;AAUbG,yBAASZ,MAAT,KAAoB,C;;AAEf,oB;;;AAGFY,wB;;;AAGT;;;AAGmBJ,U;AACyBA,oB,SAApCW,W;;AAEFA,+BAAe,I;AACV,oB;;;AAGLzB,iB,GAAI,kBAAQC,IAAR,CAAawB,WAAb,C;AACJC,wB,GAAW1B,EAAE,oIAAkBG,IAAlB,CAAuBwB,OAAzB,C;;AAEfD,yBAASjB,IAAT,CAAc,IAAd,EAAoBmB,WAApB,CAAgC,MAAhC;AACMC,8B,GAAiBH,SAASd,IAAT,E;AACnB,iBAACiB,cAAD,IAAmB,CAACA,eAAevB,M;;AAE9B,oB;;;AAGFuB,8B;;;AAGT;;;AAGc,KAAG;;AAEjB;;;AAGc,KAAG;;AAEjB;;;;;AAKuB/B,c;;;;AAIVJ,Y","file":"common.parser.js","sourcesContent":["\nimport IParser from './IParser';\nimport cheerio from 'cheerio';\n\nclass CommonParser extends IParser {\n\n  constructor({\n    config,\n  }) {\n    super({\n      config,\n    });\n\n    this.searchBookByName = this.searchBookByName.bind(this);\n  }\n\n  /**\n   * 搜索图书信息\n   */\n  async searchBook(bookName) {\n    const searchHtml = await this.searchBookByName(bookName);\n\n    if (searchHtml == null) {\n      return null;\n    }\n\n    let $ = cheerio.load(searchHtml);\n    const resultList = $(super.getConfig().eles.search).toArray();\n    \n    if (resultList.length === 0) {\n      // 未搜索到该书\n      return null;\n    }\n\n    const resultEle = resultList[0];\n    let $title = $(resultEle).find(super.getConfig().eles.title);\n    const name = $title.text().trim();\n    const link = $title.attr('href');\n    if (name != bookName.trim()) {\n      // 找到的书不符合\n      return null;\n    }\n\n    return {\n      name,\n      link,\n    };\n  }\n\n  /**\n   * 搜索章节\n   */\n  async searchChapters(link) {\n    const chaptersHtml = await super.obainHtml(link);\n\n    if (chaptersHtml == null) {\n      return null;\n    }\n\n    let $ = cheerio.load(chaptersHtml);\n    const resultList = $(super.getConfig().eles.chapter).toArray();\n    if (resultList.length === 0) {\n      // 无章节\n      return null;\n    }\n\n    const chapters = resultList.map(item => {\n      const $chapter = $(item);\n      const href = $chapter.attr('href');\n      return {\n        id: href.replace(link, '').replace(/\\//g, '').replace(/\\.html/g, ''),\n        title: $chapter.text(),\n        link: $chapter.attr('href'),\n      };\n    });\n\n    if (chapters.length === 0) {\n      // 无章节\n      return null;\n    }\n\n    return chapters;\n  }\n\n  /**\n   * 解析HTML章节内容\n   */\n  async parseContent(link) {\n    const contentHtml = await super.obainHtml(link);\n\n    if (contentHtml == null) {\n      return null;\n    }\n\n    let $ = cheerio.load(contentHtml);\n    let $content = $(super.getConfig().eles.content);\n\n    $content.find('br').replaceWith('\\r\\n');\n    const chapterContent = $content.text();\n    if (!chapterContent || !chapterContent.length) {\n      // 无内容\n      return null;\n    }\n\n    return chapterContent;\n  }\n\n  /**\n   * 上一章节\n   */\n  prevChapter() { }\n\n  /**\n   * 下一章节\n   */\n  nextChapter() { }\n\n  /**\n   * 根据图书名搜索图书\n   * \n   * @param {*} bookName \n   */\n  async searchBookByName(bookName) {};\n\n}\n\nexport default CommonParser;\n"]}