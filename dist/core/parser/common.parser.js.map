{"version":3,"sources":["../../../src/core/parser/common.parser.js"],"names":["CommonParser","config","searchBookByName","bind","bookName","searchHtml","$","load","resultList","eles","search","toArray","length","resultEle","$title","find","title","name","text","trim","link","attr","chaptersHtml","chapter","chapters","map","$chapter","item","href","id","replace","contentHtml","$content","content","replaceWith","chapterContent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;;;AACA;;;;;;IAEMA,Y;;;AAEJ,8BAEG;AAAA,QADDC,MACC,QADDA,MACC;AAAA;;AAAA,0IACK;AACJA;AADI,KADL;;AAKD,UAAKC,gBAAL,GAAwB,MAAKA,gBAAL,CAAsBC,IAAtB,OAAxB;AALC;AAMF;;AAED;;;;;;;;4GAGiBC,Q;;;;;;;uBACU,KAAKF,gBAAL,CAAsBE,QAAtB,C;;;AAAnBC,0B;;sBAEFA,cAAc,I;;;;;iDACT,I;;;AAGLC,iB,GAAI,kBAAQC,IAAR,CAAaF,UAAb,C;AACFG,0B,GAAaF,EAAE,oIAAkBG,IAAlB,CAAuBC,MAAzB,EAAiCC,OAAjC,E;;sBAEfH,WAAWI,MAAX,KAAsB,C;;;;;iDAEjB,I;;;AAGHC,yB,GAAYL,WAAW,CAAX,C;AACdM,sB,GAASR,EAAEO,SAAF,EAAaE,IAAb,CAAkB,oIAAkBN,IAAlB,CAAuBO,KAAzC,C;AACPC,oB,GAAOH,OAAOI,IAAP,GAAcC,IAAd,E;AACPC,oB,GAAON,OAAOO,IAAP,CAAY,MAAZ,C;;sBACTJ,QAAQb,SAASe,IAAT,E;;;;;iDAEH,I;;;iDAGF;AACLF,4BADK;AAELG;AAFK,iB;;;;;;;;;;;;;;;;;AAMT;;;;;;;6GAGqBA,I;;;;;;;2JACwBA,I;;;AAArCE,4B;;sBAEFA,gBAAgB,I;;;;;kDACX,I;;;AAGLhB,iB,GAAI,kBAAQC,IAAR,CAAae,YAAb,C;AACFd,0B,GAAaF,EAAE,oIAAkBG,IAAlB,CAAuBc,OAAzB,EAAkCZ,OAAlC,E;;sBACfH,WAAWI,MAAX,KAAsB,C;;;;;kDAEjB,I;;;AAGHY,wB,GAAWhB,WAAWiB,GAAX,CAAe,gBAAQ;AACtC,sBAAMC,WAAWpB,EAAEqB,IAAF,CAAjB;AACA,sBAAMC,OAAOF,SAASL,IAAT,CAAc,MAAd,CAAb;AACA,yBAAO;AACLQ,wBAAID,KAAKE,OAAL,CAAaV,IAAb,EAAmB,EAAnB,EAAuBU,OAAvB,CAA+B,KAA/B,EAAsC,EAAtC,EAA0CA,OAA1C,CAAkD,SAAlD,EAA6D,EAA7D,CADC;AAELd,2BAAOU,SAASR,IAAT,EAFF;AAGLE,0BAAMM,SAASL,IAAT,CAAc,MAAd;AAHD,mBAAP;AAKD,iBARgB,C;;sBAUbG,SAASZ,MAAT,KAAoB,C;;;;;kDAEf,I;;;kDAGFY,Q;;;;;;;;;;;;;;;;;AAGT;;;;;;;6GAGmBJ,I;;;;;;;2JACyBA,I;;;AAApCW,2B;;sBAEFA,eAAe,I;;;;;kDACV,I;;;AAGLzB,iB,GAAI,kBAAQC,IAAR,CAAawB,WAAb,C;AACJC,wB,GAAW1B,EAAE,oIAAkBG,IAAlB,CAAuBwB,OAAzB,C;;;AAEfD,yBAASjB,IAAT,CAAc,IAAd,EAAoBmB,WAApB,CAAgC,MAAhC;AACMC,8B,GAAiBH,SAASd,IAAT,E;;sBACnB,CAACiB,cAAD,IAAmB,CAACA,eAAevB,M;;;;;kDAE9B,I;;;kDAGFuB,c;;;;;;;;;;;;;;;;;AAGT;;;;;;kCAGc,CAAG;;AAEjB;;;;;;kCAGc,CAAG;;AAEjB;;;;;;;;;6GAKuB/B,Q;;;;;;;;;;;;;;;;;;;;;;kBAIVJ,Y","file":"common.parser.js","sourcesContent":["\nimport IParser from './IParser';\nimport cheerio from 'cheerio';\n\nclass CommonParser extends IParser {\n\n  constructor({\n    config,\n  }) {\n    super({\n      config,\n    });\n\n    this.searchBookByName = this.searchBookByName.bind(this);\n  }\n\n  /**\n   * 搜索图书信息\n   */\n  async searchBook(bookName) {\n    const searchHtml = await this.searchBookByName(bookName);\n\n    if (searchHtml == null) {\n      return null;\n    }\n\n    let $ = cheerio.load(searchHtml);\n    const resultList = $(super.getConfig().eles.search).toArray();\n\n    if (resultList.length === 0) {\n      // 未搜索到该书\n      return null;\n    }\n\n    const resultEle = resultList[0];\n    let $title = $(resultEle).find(super.getConfig().eles.title);\n    const name = $title.text().trim();\n    const link = $title.attr('href');\n    if (name != bookName.trim()) {\n      // 找到的书不符合\n      return null;\n    }\n\n    return {\n      name,\n      link,\n    };\n  }\n\n  /**\n   * 搜索章节\n   */\n  async searchChapters(link) {\n    const chaptersHtml = await super.obainHtml(link);\n\n    if (chaptersHtml == null) {\n      return null;\n    }\n\n    let $ = cheerio.load(chaptersHtml);\n    const resultList = $(super.getConfig().eles.chapter).toArray();\n    if (resultList.length === 0) {\n      // 无章节\n      return null;\n    }\n\n    const chapters = resultList.map(item => {\n      const $chapter = $(item);\n      const href = $chapter.attr('href');\n      return {\n        id: href.replace(link, '').replace(/\\//g, '').replace(/\\.html/g, ''),\n        title: $chapter.text(),\n        link: $chapter.attr('href'),\n      };\n    });\n\n    if (chapters.length === 0) {\n      // 无章节\n      return null;\n    }\n\n    return chapters;\n  }\n\n  /**\n   * 解析HTML章节内容\n   */\n  async parseContent(link) {\n    const contentHtml = await super.obainHtml(link);\n\n    if (contentHtml == null) {\n      return null;\n    }\n\n    let $ = cheerio.load(contentHtml);\n    let $content = $(super.getConfig().eles.content);\n\n    $content.find('br').replaceWith('\\r\\n');\n    const chapterContent = $content.text();\n    if (!chapterContent || !chapterContent.length) {\n      // 无内容\n      return null;\n    }\n\n    return chapterContent;\n  }\n\n  /**\n   * 上一章节\n   */\n  prevChapter() { }\n\n  /**\n   * 下一章节\n   */\n  nextChapter() { }\n\n  /**\n   * 根据图书名搜索图书\n   * \n   * @param {*} bookName \n   */\n  async searchBookByName(bookName) {};\n\n}\n\nexport default CommonParser;\n"]}